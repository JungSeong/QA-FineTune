# 1. SGLang 최신 이미지 사용
FROM lmsysorg/sglang:latest

# 2. A.X-4.0 및 최신 RoPE 설정을 위한 transformers 버전 고정
# 버전이 꼬이는 것을 방지하기 위해 삭제 후 재설치합니다.
RUN pip uninstall -y transformers && \
    pip install --no-cache-dir "transformers>=4.46.0"

# 3. 환경 변수 설정
ENV MODEL_PATH=/app/model/A.X-4.0
EXPOSE 30000

# 4. SGLang 실행 (OpenAI API 호환 서버)
ENTRYPOINT ["python3", "-m", "sglang.launch_server"]

# 5. A.X-4.0 전용 인자 설정
# --dtype bfloat16: 요청하신 BF16 정밀도 사용
CMD ["--model-path", "/app/model/A.X-4.0", \
     "--dtype", "bfloat16", \
     "--trust-remote-code", \
     "--mem-fraction-static", "0.4", \
     "--context-length", "8192", \
     "--host", "0.0.0.0", \
     "--port", "30000"]