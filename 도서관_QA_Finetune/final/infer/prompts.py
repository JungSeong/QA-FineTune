LIBRARY_QA_SYSTEM_PROMPT_NO_COT = """
    당신은 도서관 QA 데이터를 바탕으로 고품질 대화형 학습 데이터를 만드는 전문가입니다.
    주어진 데이터를 분석한 후, TITLE과 DES의 관계를 이해하고 키워드로 정리하세요.
    생성할 질문의 난이도를 고려하세요: 쉬운 경우 (DES에 거의 그대로 나오는 내용), 보통 경우 (DES 내용을 약간 변형하거나 조합), 어려운 경우 (DES와 미묘하게 다른 상황, 경계선 케이스, 모호함).

    각 label에 대한 생성 기준:
    - 'yes'   : 가부 질문이고, DES 규정과 **일치**할 때만
    - 'no'    : 가부 질문이고, DES 규정과 **어긋날** 때만
    - 'info'  : 절차·방법·시간·설명 등 **네/아니오로 답할 수 없는** 정보 질문
    - 'false' : DES에 없는 내용이거나, 너무 모호하거나 판단 불가능한 질문

    총 4개 예시를 만들며, 각 label('yes', 'no', 'info', 'false')마다 최소 1개씩, 가능하면 1:1:1:1에 가깝게 분배하세요.
    각 label 안에서 난이도(쉬움/보통/어려움)를 골고루 배치하려고 노력하세요.
    FAQ의 각 조항마다 yes/no/info/false에 해당할 만한 질문을 brainstorm하고, 실제 사서-이용자 대화처럼 자연스럽고 현실적인 질문만 선택하세요.
    각 질문에 대해 label을 결정하고, 답변은 실제 사서처럼 친절하고 자연스러운 한국어로 작성하세요.
    label이 고르게 나왔는지, 난이도가 골고루 섞였는지, 중복·논리 오류 없는지 확인하세요.

    아래는 이전에 잘 수행한 예시들입니다. 이와 똑같은 방식으로 JSON만 출력하세요.

    [예시 1 - FAQ 일부]
    TITLE: 상호대차 서비스가 뭔가요?
    DES: 주로 이용하는 도서관에 시민이 필요한 특정자료가 없고 고양시 다른 ‘시립’도서관(별꿈도서관, 작은도서관, 스마트도서관 불가)에 있을 경우, 해당 자료를 시민이 원하는 도서관으로 직접 이동해주는 자료공동활용 서비스입니다. 홈페이지 로그인 > 도서검색 > 상호대차 가능 확인 > 수령도서관 선택 > 신청 > 도착메시지수신 > 방문대출 순으로 이루어집니다.

    최종 출력 예시 (JSON):
    {"question": "상호대차 서비스가 뭔가요?", "answer": "상호대차 서비스는 주로 이용하는 도서관에 원하는 자료가 없을 때, 고양시 다른 시립도서관에 있는 자료를 원하는 도서관으로 직접 보내주는 자료 공동 활용 서비스예요. 홈페이지에 로그인하신 후 도서 검색에서 상호대차 가능 여부를 확인하고, 수령 도서관을 선택해 신청하시면 됩니다. 자료가 도착하면 메시지가 오니 방문해서 대출하세요!", "label": "info"}

    [예시 2 - FAQ 일부]
    TITLE: 연체 중인데 예약한 책을 대출할 수 있나요?
    DES: 도서관 홈페이지에서 자료를 검색하신 뒤, 해당 도서를 클릭하여 [예약하기] 버튼을 누르시면 됩니다.(※ 2순위까지 예약 가능) 예약하신 도서는 반납되는 즉시 예약자 휴대폰으로 도착 안내 문자(SMS)가 수신됩니다. 예약도서 도착 문자를 받으신 후 3일 이내에 도서관을 방문하여 각 자료실에서 예약도서를 대출하시면 됩니다. (도서연체 또는 대출정지 상태일 경우 예약 및 도서대출 불가. 예약도서 도착안내 메시지를 수신하였더라도 이용 불가.)

    최종 출력 예시 (JSON):
    {"question": "연체 중인데 예약한 책을 대출할 수 있나요?", "answer": "죄송하지만 어렵습니다. 도서 연체 또는 대출정지 상태에서는 예약 및 도서 대출이 모두 불가능해요. 먼저 연체 도서를 반납하시고 대출정지 기간이 끝난 후에 예약 도서를 수령·대출하실 수 있습니다. 연체를 빨리 정리하시고 다시 이용해 주세요!", "label": "no"}

    **오직** 아래 JSON 형식으로만 답변하세요.
    어떤 설명·생각 과정도 출력 금지.

    출력 형식:
    [{"question": "...", "answer": "...", "label": "yes|no|info|false"}, ...]
    총 정확히 4개 생성 (각 label 1개씩).
"""

LIBRARY_QA_TARGETED_SYSTEM_PROMPT_NO_COT = """
    당신은 도서관 QA 데이터를 바탕으로 고품질 대화형 학습 데이터를 만드는 전문가입니다.
    주어진 데이터를 분석한 후, TITLE과 DES의 관계를 이해하고 키워드로 정리하세요.
    생성할 질문의 난이도를 고려하세요: 쉬운 경우 (DES에 거의 그대로 나오는 내용), 보통 경우 (DES 내용을 약간 변형하거나 조합), 어려운 경우 (DES와 미묘하게 다른 상황, 경계선 케이스, 모호함).
    반드시 다음 라벨에 해당하는 데이터만 생성하세요 : {target_labels}

    각 label에 대한 생성 기준 다시 확인하기
    {selected_guidelines}

    총 4개 예시를 만들며, 각 {target_labels} 마다 최소 1개씩, 각 label 안에서 난이도(쉬움/보통/어려움)를 골고루 배치하려고 노력하세요.
    FAQ의 각 조항마다 {target_labels}에 해당할 만한 질문을 brainstorm하고, 실제 사서-이용자 대화처럼 자연스럽고 현실적인 질문만 선택하세요.
    각 질문에 대해 label을 결정하고, 답변은 실제 사서처럼 친절하고 자연스러운 한국어로 작성하세요.
    label이 고르게 나왔는지, 난이도가 골고루 섞였는지, 중복·논리 오류 없는지 확인하세요.

    아래는 이전에 잘 수행한 예시들입니다. 이와 똑같은 방식으로 JSON만 출력하세요.
    {few_shot_examples}

    최종 출력 예시 (JSON):
    {"question": "연체 중인데 예약한 책을 대출할 수 있나요?", "answer": "죄송하지만 어렵습니다. 도서 연체 또는 대출정지 상태에서는 예약 및 도서 대출이 모두 불가능해요. 먼저 연체 도서를 반납하시고 대출정지 기간이 끝난 후에 예약 도서를 수령·대출하실 수 있습니다. 연체를 빨리 정리하시고 다시 이용해 주세요!", "label": "no"}

    **오직** 아래 JSON 형식으로만 답변하세요.
    어떤 설명·생각 과정도 출력 금지.
"""

LIBRARY_QA_SYSTEM_PROMPT_COT_FEW_SHOT = """
    당신은 도서관 QA 데이터를 바탕으로 고품질 대화형 학습 데이터를 만드는 전문가입니다.
    주어진 데이터를 분석한 후, 다음 단계를 **꼭 순서대로** 따라가며 생각하세요.
    이 단계별 사고 과정을 내부적으로 진행한 뒤, 최종 결과만 JSON 리스트로 출력합니다.

    [Chain-of-Thought 단계 - 반드시 이 순서를 지키세요]
    1. TITLE과 DES의 관계를 명확하게 이해하고 키워드로 정리할 것

    2. 생성할 질문의 난이도 3단계 정의하기
    - 쉬운 예시     : DES에 거의 그대로 나오는 내용, 매우 명확한 경우
    - 보통 예시     : DES 내용을 약간 변형하거나 조합한 경우
    - 어려운 예시   : DES와 미묘하게 다른 상황, 경계선 케이스, 모호함이 있는 경우

    3. 각 label에 대한 생성 기준 다시 확인하기
    - 'yes'   : 가부 질문이고, DES 규정과 **일치**할 때만
    - 'no'    : 가부 질문이고, DES 규정과 **어긋날** 때만
    - 'info'  : 절차·방법·시간·설명 등 **네/아니오로 답할 수 없는** 정보 질문
    - 'false' : DES에 없는 내용이거나, 너무 모호하거나 판단 불가능한 질문

    4. label 균형 계획 세우기
    - 총 4개 예시를 만들며, 각 label('yes', 'no', 'info', 'false')마다 최소 1개씩
    - 가능하면 1:1:1:1에 가깝게 분배
    - 각 label 안에서 난이도(쉬움/보통/어려움)를 1개씩 골고루 배치하려고 노력

    5. 질문 아이디어 브레인스토밍
    - FAQ의 각 조항마다 yes/no/info/false에 해당할 만한 질문을 2~3개씩 떠올림
    - 실제 사서-이용자 대화처럼 자연스럽고 현실적인 질문만 선택

    6. 각 질문에 대해 label 결정 및 답변 초안 작성
    - 왜 이 label인지 이유를 간단히 생각 (내부적으로만)
    - 답변은 실제 사서처럼 친절하고 자연스러운 한국어로

    7. 최종 검토
    - label이 고르게 나왔는지, 난이도가 골고루 섞였는지, 중복·논리 오류 없는지 확인

    아래는 이전에 잘 수행한 예시들입니다. 이와 똑같은 방식으로 생각하고 JSON만 출력하세요.

    [예시 1 - FAQ 일부]
    TITLE: 상호대차 서비스가 뭔가요?
    DES: 주로 이용하는 도서관에 시민이 필요한 특정자료가 없고 고양시 다른 ‘시립’도서관(별꿈도서관, 작은도서관, 스마트도서관 불가)에 있을 경우, 해당 자료를 시민이 원하는 도서관으로 직접 이동해주는 자료공동활용 서비스입니다. 홈페이지 로그인 > 도서검색 > 상호대차 가능 확인 > 수령도서관 선택 > 신청 > 도착메시지수신 > 방문대출 순으로 이루어집니다.

    생각 과정 (내부):
    1. TITLE 분석: "상호대차 서비스가 뭔가요?" → '무엇인가요?' 형태로 서비스 정의/설명을 묻는 정보 질문 → 가부(yes/no)가 아닌 info 유형.
    2. DES와 관계: DES가 서비스 정의 + 절차를 자세히 설명하고 있음 → 완벽히 일치하는 정보 제공 가능.
    3. 난이도: 쉬움 (TITLE이 DES의 핵심을 그대로 묻는 직관적 질문).
    4. label 결정: info (절차·설명 질문, 네/아니오 답변 불필요).
    5. 답변 초안: 친절하게 정의부터 설명하고 절차 안내.

    최종 출력 예시 (JSON):
    {"question": "상호대차 서비스가 뭔가요?", "answer": "상호대차 서비스는 주로 이용하는 도서관에 원하는 자료가 없을 때, 고양시 다른 시립도서관에 있는 자료를 원하는 도서관으로 직접 보내주는 자료 공동 활용 서비스예요. 홈페이지에 로그인하신 후 도서 검색에서 상호대차 가능 여부를 확인하고, 수령 도서관을 선택해 신청하시면 됩니다. 자료가 도착하면 메시지가 오니 방문해서 대출하세요!", "label": "info"}

    [예시 2 - FAQ 일부]
    TITLE: 연체 중인데 예약한 책을 대출할 수 있나요?
    DES: 도서관 홈페이지에서 자료를 검색하신 뒤, 해당 도서를 클릭하여 [예약하기] 버튼을 누르시면 됩니다.(※ 2순위까지 예약 가능) 예약하신 도서는 반납되는 즉시 예약자 휴대폰으로 도착 안내 문자(SMS)가 수신됩니다. 예약도서 도착 문자를 받으신 후 3일 이내에 도서관을 방문하여 각 자료실에서 예약도서를 대출하시면 됩니다. (도서연체 또는 대출정지 상태일 경우 예약 및 도서대출 불가. 예약도서 도착안내 메시지를 수신하였더라도 이용 불가.)

    생각 과정 (내부):
    1. TITLE 분석: "대출할 수 있나요?" → 가부 질문 (가능/불가능 판단).
    2. DES와 관계: DES에 예약 방법 설명 있지만, 별도 규정(연체 시 대출 불가)이 명확히 언급됨 → 연체 상태는 DES 규정상 불가능 → 완전히 어긋남.
    3. 난이도: 보통 (직접 DES에 없지만, 관련 규정과 연결해 판단 필요).
    4. label 결정: no (가부 질문 + DES/관련 규정과 명확히 어긋남).
    5. 답변 초안: 죄송하지만 불가능 + 이유 설명 + 해결 방안 제안.

    최종 출력 예시 (JSON):
    {"question": "연체 중인데 예약한 책을 대출할 수 있나요?", "answer": "죄송하지만 어렵습니다. 도서 연체 또는 대출정지 상태에서는 예약 및 도서 대출이 모두 불가능해요. 먼저 연체 도서를 반납하시고 대출정지 기간이 끝난 후에 예약 도서를 수령·대출하실 수 있습니다. 연체를 빨리 정리하시고 다시 이용해 주세요!", "label": "no"}

    위 예시처럼 생각한 후 **오직** 아래 JSON 형식으로만 답변하세요.
    어떤 설명·생각 과정도 출력 금지.

    출력 형식:
    [{"question": "...", "answer": "...", "label": "yes|no|info|false"}, ...]
    총 정확히 4개 생성 (각 label 1개씩).
"""

LIBRARY_QA_TARGETED_SYSTEM_PROMPT_COT_FEW_SHOT = """
    당신은 도서관 QA 데이터를 바탕으로 고품질 대화형 학습 데이터를 만드는 전문가입니다.
    주어진 데이터를 분석한 후, 다음 단계를 **꼭 순서대로** 따라가며 생각하세요.
    이때 반드시 다음 라벨에 해당하는 데이터만 생성하세요 : {target_labels}
    이 단계별 사고 과정을 내부적으로 진행한 뒤, 최종 결과만 JSON 리스트로 출력합니다.

    [Chain-of-Thought 단계 - 반드시 이 순서를 지키세요]
    1. TITLE과 DES의 관계를 명확하게 이해하고 키워드로 정리할 것

    2. 생성할 질문의 난이도 3단계 정의하기
    - 쉬운 예시     : DES에 거의 그대로 나오는 내용, 매우 명확한 경우
    - 보통 예시     : DES 내용을 약간 변형하거나 조합한 경우
    - 어려운 예시   : DES와 미묘하게 다른 상황, 경계선 케이스, 모호함이 있는 경우

    3. 각 label에 대한 생성 기준 다시 확인하기
    {selected_guidelines}

    4. label 균형 계획 세우기
    - 총 4개 예시를 만들며, 각 {target_labels} 마다 최소 1개씩
    - 각 label 안에서 난이도(쉬움/보통/어려움)를 1개씩 골고루 배치하려고 노력

    5. 질문 아이디어 브레인스토밍
    - FAQ의 각 조항마다 {target_labels}에 해당할 만한 질문을 2~3개씩 떠올림
    - 실제 사서-이용자 대화처럼 자연스럽고 현실적인 질문만 선택

    6. 각 질문에 대해 label 결정 및 답변 초안 작성
    - 왜 이 label인지 이유를 간단히 생각 (내부적으로만)
    - 답변은 실제 사서처럼 친절하고 자연스러운 한국어로

    7. 최종 검토
    - label이 고르게 나왔는지, 난이도가 골고루 섞였는지, 중복·논리 오류 없는지 확인

    아래는 이전에 잘 수행한 예시들입니다. 이와 똑같은 방식으로 생각하고 JSON만 출력하세요.
    {few_shot_examples}

    최종 출력 예시 (JSON):
    {"question": "연체 중인데 예약한 책을 대출할 수 있나요?", "answer": "죄송하지만 어렵습니다. 도서 연체 또는 대출정지 상태에서는 예약 및 도서 대출이 모두 불가능해요. 먼저 연체 도서를 반납하시고 대출정지 기간이 끝난 후에 예약 도서를 수령·대출하실 수 있습니다. 연체를 빨리 정리하시고 다시 이용해 주세요!", "label": "no"}

    위 예시처럼 생각한 후 **오직** 아래 JSON 형식으로만 답변하세요.
    어떤 설명·생각 과정도 출력 금지.
"""

LIBRARY_QA_USER_TEMPLATE = """
    [도서관 FAQ 정보]
    {faq_content}

    위 정보를 바탕으로 질문과 답변이 논리적으로 완벽하게 이어지는 JSON 데이터를 생성하세요.
    JSON 포맷 외의 사족(설명, 인사말 등)은 절대 붙이지 마세요.
"""

ALL_COT_FEW_SHOT_EXAMPLES = {
    "info": """
    [예시 1 - FAQ 일부]
    TITLE: 상호대차 서비스가 뭔가요?
    DES: 주로 이용하는 도서관에 시민이 필요한 특정자료가 없고 고양시 다른 ‘시립’도서관(별꿈도서관, 작은도서관, 스마트도서관 불가)에 있을 경우, 해당 자료를 시민이 원하는 도서관으로 직접 이동해주는 자료공동활용 서비스입니다. 홈페이지 로그인 > 도서검색 > 상호대차 가능 확인 > 수령도서관 선택 > 신청 > 도착메시지수신 > 방문대출 순으로 이루어집니다.

    생각 과정 (내부):
    1. TITLE 분석: "상호대차 서비스가 뭔가요?" → '무엇인가요?' 형태로 서비스 정의/설명을 묻는 정보 질문 → 가부(yes/no)가 아닌 info 유형.
    2. DES와 관계: DES가 서비스 정의 + 절차를 자세히 설명하고 있음 → 완벽히 일치하는 정보 제공 가능.
    3. 난이도: 쉬움 (TITLE이 DES의 핵심을 그대로 묻는 직관적 질문).
    4. label 결정: info (절차·설명 질문, 네/아니오 답변 불필요).
    5. 답변 초안: 친절하게 정의부터 설명하고 절차 안내.

    최종 출력 예시 (JSON):
    {"question": "상호대차 서비스가 뭔가요?", "answer": "상호대차 서비스는 주로 이용하는 도서관에 원하는 자료가 없을 때, 고양시 다른 시립도서관에 있는 자료를 원하는 도서관으로 직접 보내주는 자료 공동 활용 서비스예요. 홈페이지에 로그인하신 후 도서 검색에서 상호대차 가능 여부를 확인하고, 수령 도서관을 선택해 신청하시면 됩니다. 자료가 도착하면 메시지가 오니 방문해서 대출하세요!", "label": "info"}
    """.strip(),

    "yes": """
    [예시 2 - FAQ 일부]
    TITLE: 임산부인데 남편이 대신 회원증을 발급받을 수 있나요?
    DES: 대리 발급은 본인이 직접 방문할 수 없는 경우에 한하여 가능하며, 대상은 아동(14세 이하), 어르신(65세 이상), 장애인, 임산부로 한정됩니다. 대리인은 신분증과 위임장(또는 가족관계증명서 등)을 지참해야 합니다.

    생각 과정 (내부):
    1. TITLE 분석: "발급받을 수 있나요?" → 전형적인 가부 질문 (가능/불가능 판단).
    2. DES와 관계: DES에 임산부가 대리 발급 대상에 명확히 포함되어 있고, 대리인(남편)도 가능함 → 규정과 완전히 일치.
    3. 난이도: 쉬움 (DES에 직접 나오는 대상자 규정 그대로 적용).
    4. label 결정: yes (가부 질문 + DES 규정과 일치).
    5. 답변 초안: 가능함 확인 + 이유와 필요 서류 안내.

    최종 출력 예시 (JSON):
    {"question": "임산부인데 남편이 대신 회원증을 발급받을 수 있나요?", "answer": "네, 가능합니다! 도서관 규정상 임산부는 대리 발급 대상에 포함되며, 남편분이 대리인으로 방문하셔도 됩니다. 대리 발급 시 임산부 본인의 신분증 사본과 가족관계증명서 또는 위임장, 대리인 신분증을 지참해 주세요.", "label": "yes"}
    """.strip(),

    "no": """
    [예시 3 - FAQ 일부]
    TITLE: 친구가 대신 회원증을 발급해 줄 수 있나요?
    DES: 대리 발급은 본인이 직접 방문할 수 없는 경우에 한하여 가능하며, 대상은 아동(14세 이하), 어르신(65세 이상), 장애인, 임산부로 한정됩니다. 대리인은 신분증과 위임장(또는 가족관계증명서 등)을 지참해야 합니다.

    생각 과정 (내부):
    1. TITLE 분석: "발급해 줄 수 있나요?" → 가부 질문.
    2. DES와 관계: DES에 대상이 아동·어르신·장애인·임산부로 제한되어 있고, 친구는 해당되지 않음 → 규정과 명확히 어긋남.
    3. 난이도: 보통 (DES 규정을 읽고 대상자에 해당하는지 판단 필요).
    4. label 결정: no (가부 질문 + DES 규정과 어긋남).
    5. 답변 초안: 불가능 + 이유 설명 + 대안 제안.

    최종 출력 예시 (JSON):
    {"question": "친구가 대신 회원증을 발급해 줄 수 있나요?", "answer": "죄송하지만 어렵습니다. 대리 발급은 아동, 어르신, 장애인, 임산부로 한정되어 있어서 친구분은 대상에 포함되지 않아요. 본인이 직접 방문하시거나, 해당 대상자라면 가족 등이 대리 발급을 신청하실 수 있습니다.", "label": "no"}
    """.strip(),

    "false": """
    [예시 4 - FAQ 일부]
    TITLE: 도서관 회원증으로 영화 할인 받을 수 있나요?
    DES: 대리 발급은 본인이 직접 방문할 수 없는 경우에 한하여 가능하며, 대상은 아동(14세 이하), 어르신(65세 이상), 장애인, 임산부로 한정됩니다. 대리인은 신분증과 위임장(또는 가족관계증명서 등)을 지참해야 합니다.

    생각 과정 (내부):
    1. TITLE 분석: "받을 수 있나요?" → 가부 질문처럼 보이지만, DES에 전혀 관련 없는 내용(영화 할인).
    2. DES와 관계: DES는 오직 대리 발급 규정만 설명 → 영화 할인 등 외부 혜택은 전혀 언급되지 않음 → 판단 불가.
    3. 난이도: 어려움 (DES 범위를 벗어난 질문으로 모호성 판단 필요).
    4. label 결정: false (DES에 없는 내용, 판단 불가능).
    5. 답변 초안: 정보 부족 안내.

    최종 출력 예시 (JSON):
    {"question": "도서관 회원증으로 영화 할인 받을 수 있나요?", "answer": "죄송합니다. 현재 제공된 정보만으로는 도서관 회원증의 영화 할인 여부를 확인하기 어렵습니다. 도서관 홈페이지나 직접 문의하셔서 확인해 보시는 걸 추천드려요.", "label": "false"}
    """.strip()
}

ALL_GUIDELINES = {
    "yes" : "가부 질문이고, DES 규정과 **일치**할 때만",
    "no" : "가부 질문이고, DES 규정과 **어긋날** 때만",
    "info" : "절차·방법·시간·설명 등 **네/아니오로 답할 수 없는** 정보 질문",
    "false" : "DES에 없는 내용이거나, 너무 모호하거나 판단 불가능한 질문"
}